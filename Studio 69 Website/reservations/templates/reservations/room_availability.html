{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Studio 69</title>
    <style>
        html, body{
            margin: 0;
            height: 100%;
            text-overflow: clip;
            text-wrap: nowrap;
            padding: 5px;
        }
        body {
            font-family: Arial, Helvetica, sans-serif;

        }
        .navbar{
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            overflow: hidden;
            background-color: #0000009d;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.275);
            color: #ffffff;
            transition: 0.3s ease;
        }
        .navbar.sticky{
            background-color: #000000;
            transition:0.3s ease;
        }
        .navbar_logo{
            width: 240px;
            height: auto;
            position: absolute;
            top: 5px;
            
        }
        .navbar nav {
            justify-content: space-between;
            align-items: center;
            display: flex;
            padding: 10px;
        }
        .navbar ul {
            list-style: none;
            margin: auto;
            color: #333;
            display: flex;
            padding: 0;
        }
        .navbar li {
            padding: 10px;
            text-decoration: none;
            color: #000000;
            font-size: 20px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            
        }
        .navbar a:hover {
            border-bottom: 4px #ffffff solid;
            padding-bottom: 6px;
                    }
        .navbar a{
            color: #ffffff;
            text-decoration: none;
        }
        .logout-button {
            background-color: transparent;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            position: absolute;
            right: 2%;
            font-size: 20px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .logout-button:hover {
            background-color: rgb(70, 21, 21);
            box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
            transform: translateY(-2px);
            transition: transform 0.2s;
        }
        .profile{
            position: relative;
            display: inline-block;
            position: fixed;
            right: 10px;
            top: 5px;
            border: none;
        }
        .login_symbol{
            height:50px;
            width: auto;
        }
        .profile:hover .login_symbol{
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            border-radius: 20px;
        }
        .profile_content{
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            transform: translateX(-160px);
            border: none;
        }
        .profile a{
            color: black;
            text-decoration: none;
            display: block;
            text-align: center;
            padding: 5px;
            margin: auto;
        }
        .profile:hover .profile_content{
            display: block;
            border: none;
        } 
        .profile_content a:hover{
            background-color: #ddd;;
            text-decoration: none;
            border: none;
        }
        .profile_content li:hover{
            border-color: #f1f1f1;;
        }
        .main{
            transition: transform 0.3s; 
            transform: translateX(0%);
            position: fixed;
            top: 110px;
            z-index: 1000;
            background-color: white;
               
        }
        .main.sticky{
            background-color: white;
        }
        .sidebar{
            position: fixed;
            top: 80px;
            z-index: 100;
            overflow: hidden;
            transition: 0.3s ease;
            margin-left: 10px;
            background-color:transparent;
            border: none;
            cursor: pointer;
            font-size: 30px;
            font-weight: bold;
            background-color: white;
            
        }
        .sidebar.sticky{
            background-color: transparent
        }
        .filter_symbol{
            width:30px;
            height: auto;
        }
        .filter-container {
            margin: 0px 20px;
            display: block;
            width: 330px;
            left: 0;
            position: fixed;
            z-index: 1000;
            overflow-y: auto;
            scrollbar-width: none;
            background-color: white;
        }
        .rt-disc{
            margin-left: 60px;
            font-size: 10px;
            color: #3333339f;
            padding: 0;
            margin:0;
            font-weight: lighter;
            text-align: left;
            padding-left: 15px;
            padding-top: 5px;
        }
        .filter-title{
            border-top: #33333388 2px solid;
            padding-top: 10px;
            margin-top: 20px;
        }
        .roomtype-container{
            margin-left: 10px;
            
        }
        .roomtype-container input[type="checkbox"] {
            display: none;
            visibility: hidden;
        }
        .roomtype-container label:hover::before{
            color: #fff;
            background-color: #2cbc63;
            box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
            transform: translateY(-2px);
        }
        .roomtype-container label {
            position: relative;
            padding-left: 2em;
            padding-right: 1em;
            line-height: 2;
            cursor: pointer;
            display: inline-flex;
        }
    
        .roomtype-container label:before {
            box-sizing: border-box;
            content: " ";
            position: absolute;
            top: 0.3em;
            left: 0;
            display: block;
            width: 1.4em;
            height: 1.4em;
            border: 2px solid #9098A9;
            border-radius: 6px;
            z-index: -1;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        }

        .roomtype-container input[type=checkbox]:checked + label {
            padding-left: 1em;
            color: #0f5229;
        }
        .roomtype-container input[type=checkbox]:checked + label:before {
            top: 0;
            width: 100%;
            height: 2em;
            background: #b7e6c9;
            border-color: #2cbc63;
        }
    
        .roomtype-container label,
        .roomtype-container label::before {
            transition: 0.25s all ease; 
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px;
            flex-grow: 1;
            transform: translateX(35%);
            margin-top: 120px;
            transition:  0.3s;
            width: 70%;
        }
        .main.show{
            max-height: 0;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transform: translateX(-100%);
            transition: all 0.3s ease-in-out;
        }
        .grid-container.show{
            transition: transform 0.3s;
            transform: translateX(0%);
            margin-left: auto;
            margin-right: auto;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            width: 90%;
            top: 50;
        }
        .room {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgb(0, 0, 0);
            font-weight: bold;
            border-radius: 5px;
            text-decoration: none;
            padding: 10px;
            max-width: 100%;
            height: auto;
            transition: 0.3s ease;
        }
        .room:hover{
            background-color: #3333331c;
            transition: 0.3s ease;
            transform: translateY(-4px);
        }
        .room:active{
            transform: translateY(0px);
        }
        .studio-pic{
            max-width: 100%;
            height: auto;
        }
        .pic-desc{
            font-size: 10px;
            color: #3333339f;
            padding: 0;
            margin:0;
            font-weight: lighter;
        }
        .card-title{
            text-align: left;
            padding: 0;
            margin-bottom: 10px;
            font-size: 25px;
            margin-top: 10px;
        }
        .room ul{
            list-style: none;
            margin: auto;
            padding: 0;
            margin: 10px 0px;
        }
        .room li{
            font-size: 20px;
            font-weight: normal;
            margin-top: 5px;
        }
        .available {
            background-color: rgb(255, 255, 255);
        }
        .unavailable {
            background-color: rgb(255, 255, 255);
        }
        .floor-button {
            padding: 5px 10px;
            margin: 5px;
            border: 2px solid #9098A9;
            border-radius: 5px;
            cursor: pointer;
            background-color: transparent;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        }
        .floor-button:hover{
            color: #fff;
            background-color: #2cbc63;
            box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
            transform: translateY(-2px);
        }
        .selected {
            top: 0;
            background: #b7e6c9;
            border: #2cbc63 2px solid;    
        }
        .floorbtn_container{
            margin-left: 10px;
        }
        .floor-button:active{
            transform: translateY(0);
            box-shadow: none;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        .slider-value {
            min-width: 50px;
        }
        .filterbtn {
            appearance: none;
            background-color: transparent;
            border: 2px solid #1A1A1A;
            border-radius: 15px;
            box-sizing: border-box;
            color: #3B3B3B;
            cursor: pointer;
            display: inline-block;
            font-family: Roobert,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
            font-size: 16px;
            font-weight: 600;
            line-height: normal;
            margin: 20px 10px;
            min-height: 30px;
            min-width: 0;
            outline: none;
            padding: 4px 8px;
            text-align: center;
            text-decoration: none;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            width: 300px;
            will-change: transform;
        }
        .filterbtn:disabled {
            pointer-events: none;
        }
        .filterbtn:hover {
            color: #fff;
            background-color: #1A1A1A;
            box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
            transform: translateY(-2px);
        }
        .filterbtn:active {
            box-shadow: none;
            transform: translateY(0);
        }
        #start_date, #end_date{
            margin-left: 10px;
            font-family: Arial, Helvetica, sans-serif;
            cursor: pointer;
        }

        #end_date{
            margin-left: 17px;
            font-family: Arial, Helvetica, sans-serif;
        }
        .pricerange{
            font-weight: normal;
        }
        .slider {
                -webkit-appearance: none;
                width: 100%;
                height: 5px;
                border-radius: 5px;  
                background: #d3d3d3;
                outline: none;
                opacity: 0.7;
                -webkit-transition: .2s;
                transition: opacity .2s;
            }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%; 
            background: #d3d3d3;
            cursor: pointer;
            border: #0f5229 2px solid;
            transform: translateY(0px);
            transition: translate 0.2s;
        }
        .slider::-webkit-slider-thumb:hover{
            background: #04AA6D;
            transform: translateY(-1px);
            transition: translate 0.2s;
            box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
        }
    </style>
</head>
<body>
    <div class="navbar">
    <nav>
        <a href="{% url 'home' %}"><img class="navbar_logo" src="{% static 'reservations/images/Navbar_Logo.png' %}" alt="Studio 69"></a>
        <ul>
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'room_availability' %}">Available Rooms</a></li>
            <li><a href="{% url 'building_overview' %}">Building Calendar</a></li> <!-- Link to building overview -->
            {% if user.is_authenticated %}
            <li><a href="{% url 'reservation_history' %}">Reservation History</a></li> <!-- Link to reservation history -->
            <form action="{% url 'logout' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="logout-button">Log Out</button>
            </form>
            {% else %}
                <div class="profile">
                    <img class="login_symbol" src="{% static 'reservations/images/login symbol.png' %}" alt="Login">
                    <div class="profile_content">
                        <li><a href="{% url 'login' %}">Log In</a></li>
                        <li><a href="{% url 'register' %}">Create Account</a></li>
                    </div>
                </div>
            {% endif %}
        </ul>
    </nav>
</div>

    <button type="button" id="sidebar" class="sidebar" onclick="main()">Filter
        <img class="filter_symbol" src="{% static 'reservations/images/Filter symbol.png' %}" alt="Filter Symbol">
    </button>

    <div class="main" id="main">
        <div class="filter-container">
        <form id="filter-form" action="{% url 'room_availability' %}" method="get">
            <div class="filter-section">
                <h3 class="filter-title">Room Type</h3>
                <div class="roomtype-container">
                    <input type="checkbox" id="room_types1" name="room_types" value="studio" {% if 'studio' in room_types %}checked{% endif %}>
                    <label for="room_types1">Studio</label><br>
                    <input type="checkbox" id="room_types2" name="room_types" value="1-bed" {% if '1-bed' in room_types %}checked{% endif %}> 
                    <label for="room_types2"> 1 Bedroom</label><br>
                    <input type="checkbox" id="room_types3" name="room_types" value="2-bed" {% if '2-bed' in room_types %}checked{% endif %}> 
                    <label for="room_types3"> 2 Bedrooms</label><br>
                </div>
                <p class="rt-disc">*All room types have patios</p>
            </div>

            <div>
                <h3 class="filter-title">Floor:</h3>
                <div class="floorbtn_container">
                  {% for floor in available_floors %}
                    <button type="button" class="floor-button {% if floor in floors %}selected{% endif %}" data-floor="{{ floor }}">{{ floor }}</button>
                {% endfor %}
                <input type="hidden" name="floors" id="floors" value="{{ floors|join:',' }}">  
                </div>   
            </div>

            <div>
                <h3 for="price_range" class="filter-title">Price range:</h3>
                <div class="slider-container">
                    <label for="price_range_min" class="pricerange">Minimum:</label>
                    <input type="range" class="slider" id="price_range_min" name="min_price" min="0" max="10000" value="{{ min_price }}">
                    <span class="slider-value" id="price_min_display">{{ min_price }}</span>
                </div>
                <div class="slider-container">
                  <label for="price_range_max" class="pricerange">Maximum:</label>
                    <input type="range" class="slider" id="price_range_max" name="max_price" min="0" max="10000" value="{{ max_price }}">
                    <span class="slider-value" id="price_max_display">{{ max_price }}</span>  
                </div>
            </div>

            <div style="margin-top: 40px; border-top: #33333388 2px solid; padding: 0;">
                <h3 for="start_date" style="display: inline-block; margin-top: 10px;">Start Date:</h3>
                <input type="date" name="start_date" id="start_date" value="{{ start_date }}" required>
            </div>
            <div>
                <h3 for="end_date" style="display: inline;">End Date:</h3>
                <input type="date" name="end_date" id="end_date" value="{{ end_date }}" required>
            </div>

            <button type="submit" class="filterbtn">Filter</button>
        </form>
        </div>
        </div>

        <div class="grid-container" id="grid-container">
            {% for room in rooms %}
                <a href="{% if user.is_authenticated %}{% url 'room_detail' room.id %}{% else %}{% url 'login' %}{% endif %}" class="room {% if room.is_booked %}unavailable{% else %}available{% endif %}">
                    {% if room.get_type_display == "Studio" %}
                        <div class="room-card">
                            <img src="{% static 'reservations/images/Studio.png' %}" alt ="Render of Studio Unit" class="studio-pic">
                            <p class="pic-desc">Render of Studio Model Unit</p>
                        <h4 class="card-title">
                            Studio Unit
                        </h4>
                        <ul>
                            <li>Room {{ room.unit }}</li>
                            <li>₱{{ room.price }}</li>
                        </ul>
                        </div>
                    {% elif room.get_type_display == "1 Bedroom" %}
                        <div class="room-card">
                            <img src="{% static 'reservations/images/1 bedroom.png' %}" alt ="Render of 1 Bedroom Unit" class="studio-pic">
                            <p class="pic-desc">Render of 1-Bedroom Model Unit</p>
                        <h4 class="card-title">
                            1-Bedroom Unit
                        </h4>
                        <ul>
                            <li>Room {{ room.unit }}</li>
                            <li>₱{{ room.price }}</li>
                        </ul>
                        </div>
                    {% elif room.get_type_display == "2 Bedrooms" %}
                    <div class="room-card">
                        <img src="{% static 'reservations/images/2 Bedrooms.png' %}" alt ="Render of 2-Bedroom Unit" class="studio-pic">
                        <p class="pic-desc">Render of 2-Bedroom Model Unit</p>
                    <h4 class="card-title">
                        2-Bedroom Unit
                    </h4>
                    <ul>
                        <li>Room {{ room.unit }}</li>
                        <li>₱{{ room.price }}</li>
                    </ul>
                    </div>
                    {% endif %}

                </a>
            {% endfor %}
        </div>

    <script>
        function main() {
            var main = document.getElementById('main');
            var grid_container = document.getElementById('grid-container');
            main.classList.toggle('show');
            grid_container.classList.toggle('show');
        }

        window.addEventListener('scroll', function() {
        var navbar = document.getElementById('navbar');
        var sidebar = document.getElementById('sidebar');
        var main = document.getElementById('main')
        if (window.scrollY > 50) { // Adjust scroll value as needed
            navbar.classList.add('sticky');
            sidebar.classList.add('sticky');
            main.classList.add('sticky');
        } else {
            navbar.classList.remove('sticky');
            sidebar.classList.remove('sticky');
            main.classList.remove('sticky');
        }
        });
               // Set minimum date for start date input
               const today = new Date().toISOString().split('T')[0];
        document.getElementById('start_date').setAttribute('min', today);
        document.getElementById('end_date').setAttribute('min', today);

        const floorButtons = document.querySelectorAll('.floor-button');
        const floorsInput = document.getElementById('floors');
        let selectedFloors = floorsInput.value.split(',').filter(Boolean);

            floorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const floor = this.getAttribute('data-floor');
                    if (selectedFloors.includes(floor)) {
                        selectedFloors = selectedFloors.filter(f => f !== floor);
                        this.classList.remove('selected');
                    } else {
                        selectedFloors.push(floor);
                        this.classList.add('selected');
                    }
                    floorsInput.value = selectedFloors.join(',');
                });

            // Set the selected class based on the previously selected floors
            const floorNum = button.getAttribute('data-floor');
            if (selectedFloors.includes(floorNum)) {
                button.classList.add('selected');
            }
        });

        // Add event listeners to enforce date validation
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');

        startDateInput.addEventListener('change', function() {
            endDateInput.setAttribute('min', this.value);
        });

        endDateInput.addEventListener('change', function() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(this.value);
            if (endDate <= startDate) {
                alert("End date must be after the start date.");
                this.value = '';
            }
        });

        // Update slider display values and enforce price constraints
        const priceMinInput = document.getElementById('price_range_min');
        const priceMaxInput = document.getElementById('price_range_max');
        const priceMinDisplay = document.getElementById('price_min_display');
        const priceMaxDisplay = document.getElementById('price_max_display');

        priceMinInput.addEventListener('input', () => {
            if (parseInt(priceMinInput.value) > parseInt(priceMaxInput.value)) {
                priceMinInput.value = priceMaxInput.value;
            }
            priceMinDisplay.textContent = priceMinInput.value;
        });

        priceMaxInput.addEventListener('input', () => {
            if (parseInt(priceMaxInput.value) < parseInt(priceMinInput.value)) {
                priceMaxInput.value = priceMinInput.value;
            }
            priceMaxDisplay.textContent = priceMaxInput.value;
        });

        // Set initial slider display values
        priceMinDisplay.textContent = priceMinInput.value;
        priceMaxDisplay.textContent = priceMaxInput.value;
    </script>
</body>
</html>
